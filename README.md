# Multi-Index-Group-By-vs-Pivot-Table

# So sánh Multi-index Group By và Pivot Table trong Pandas

| **Tiêu chí**                | **Multi-index Group By**                                                                 | **Pivot Table**                                                                      |
|-----------------------------|-----------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------|
| **Định nghĩa**              | Nhóm dữ liệu theo nhiều cột, tạo DataFrame với chỉ số phân cấp (multi-index) cho hàng và/hoặc cột. | Tổng hợp dữ liệu dưới dạng bảng chéo, với chỉ số hàng, cột, và giá trị tổng hợp.    |
| **Cấu trúc kết quả**        | DataFrame với multi-index hàng (ví dụ: `region`, `category`, `product`) và cột có thể là multi-index (ví dụ: `sales_sum`, `sales_mean`). | Bảng chéo với chỉ số hàng (index), cột (columns), và giá trị tổng hợp (values).     |
| **Ví dụ code**              | ```python<br>agg_funcs = {'sales': ['sum', 'mean', 'count'], 'net_revenue': ['sum', 'mean', 'std'], 'price': ['min', 'max', 'median']}<br>grouped = df.groupby(['region', 'category', 'product']).agg(agg_funcs)``` | ```python<br>pivot = pd.pivot_table(df, values=['sales', 'net_revenue'], index=['region', 'customer_type'], columns='product', aggfunc='sum', fill_value=0, margins=True)``` |
| **Kết quả mẫu**             | ```region   category product   sales_sum  sales_mean  sales_count<br>Hà Nội   Điện tử Laptop    1500       300.0       5<br>                 Phone     2000       400.0       5<br>TP.HCM   Thời trang Quần áo 1000       200.0       5``` | ```region   customer_type  sales_Laptop  sales_Phone  sales_Quần áo  sales_All<br>Hà Nội   Doanh nghiệp   1000          800          0             1800<br>         Cá nhân        500         1200          0             1700<br>TP.HCM   Doanh nghiệp    600           0         700            1300``` |
| **Hàm tổng hợp**            | Linh hoạt, hỗ trợ nhiều hàm khác nhau cho từng cột (qua dictionary `agg_funcs`).         | Hỗ trợ nhiều hàm, nhưng thường áp dụng cùng hàm (hoặc danh sách) cho tất cả cột.    |
| **Xử lý giá trị thiếu**     | Không tự động xử lý `NaN`, cần dùng `fillna()` thủ công.                                | Có `fill_value` để thay thế `NaN` (ví dụ: `fill_value=0`).                          |
| **Tổng cộng (Margins)**     | Không tự động, cần tính thủ công (ví dụ: `grouped.groupby(level=0).sum()`).             | Tích hợp `margins=True` để thêm hàng/cột tổng (`All`).                              |
| **Tính trực quan**          | Dạng danh sách dài, khó đọc hơn, cần định dạng lại (như `unstack`) để so sánh ngang.    | Dạng bảng chéo, trực quan, dễ so sánh ngang (theo cột).                             |
| **Bộ nhớ và hiệu suất**     | Nhẹ hơn, vì giữ dữ liệu ở dạng danh sách dài, dễ tích lũy với **chunking**.             | Tốn bộ nhớ hơn nếu cột `columns` có nhiều giá trị duy nhất, khó xử lý dữ liệu lớn.   |
| **Ứng dụng**                | Phân tích chi tiết, đa chiều, dữ liệu lớn, tích hợp với **chunking** để xử lý dần dần.   | Báo cáo, so sánh nhanh, trực quan hóa, phù hợp với dữ liệu vừa hoặc đã xử lý trước.  |
| **Tích hợp với chunking**   | Dễ dàng tích lũy kết quả từ các chunk (ví dụ: dùng `add` để gộp).                      | Cần gộp các pivot table từ chunk (phức tạp hơn, thường dùng `sum` cho `aggfunc='sum'`). |
| **Tối ưu hóa với category** | Chuyển cột nhóm sang kiểu **category** để giảm bộ nhớ (ví dụ: `df['region'] = df['region'].astype('category')`). | Tương tự, áp dụng kiểu **category** cho `index` và `columns` để giảm bộ nhớ.        |
| **Trực quan hóa**           | Cần định dạng lại (như `unstack`) để vẽ biểu đồ (ví dụ: `grouped['sales']['sum'].unstack().plot()`). | Dễ dàng vẽ biểu đồ trực tiếp (ví dụ: `pivot['sales'].plot(kind='bar')`).            |
| **Khi nên sử dụng**         | - Phân tích chi tiết, nhiều hàm tổng hợp.<br>- Dữ liệu lớn với **chunking**.<br>- Cần truy cập nhóm con theo nhiều cấp độ. | - Báo cáo, so sánh nhanh.<br>- Dữ liệu vừa, đã lọc trước.<br>- Cần tổng cộng (`margins`) hoặc bảng chéo trực quan. |
